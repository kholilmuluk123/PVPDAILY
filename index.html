<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Account Tracker</title>
<style>
body {
  font-family: 'Inter', sans-serif;
  background: #f4f7fb;
  padding: 20px;
}

.row {
  display: grid;
  grid-template-columns: 220px 1fr 120px 120px 140px;
  align-items: center;
  gap: 12px;
  background: white;
  padding: 14px;
  border-radius: 10px;
  margin-bottom: 10px;
}

.account-name {
  font-weight: 600;
}

.slider {
  width: 100%;
  height: 10px;
  border-radius: 10px;
  appearance: none;
  background: green;
  cursor: pointer;
}

.slider::-webkit-slider-thumb {
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: #333;
}

.check {
  width: 22px;
  height: 22px;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="container"></div>

<script>
const accounts = ["Account 1", "Account 2", "Account 3"];

const container = document.getElementById("container");

// ================= RESET LOGIC =================
function isNewDay(key) {
  const last = localStorage.getItem(key);
  const now = new Date();
  if (!last) return true;
  return new Date(last).toDateString() !== now.toDateString();
}

function isNewWeek(key) {
  const last = localStorage.getItem(key);
  const now = new Date();
  const monday = new Date(now);
  monday.setDate(now.getDate() - now.getDay() + 1);
  monday.setHours(5,0,0,0);
  return !last || new Date(last) < monday;
}

// ================= UI =================
accounts.forEach((name, i) => {
  const row = document.createElement("div");
  row.className = "row";

  // Account name
  const acc = document.createElement("div");
  acc.className = "account-name";
  acc.innerText = name;

  // Slider
  const slider = document.createElement("input");
  slider.type = "range";
  slider.min = 0;
  slider.max = 100;
  slider.className = "slider";

  const sliderKey = `slider_${i}`;
  if (isNewWeek(`slider_reset_${i}`)) {
    slider.value = 0;
    localStorage.setItem(sliderKey, 0);
    localStorage.setItem(`slider_reset_${i}`, new Date());
  } else {
    slider.value = localStorage.getItem(sliderKey) || 0;
  }

  function updateSliderColor(val) {
    if (val <= 40) slider.style.background = "green";
    else if (val <= 70) slider.style.background = "gold";
    else slider.style.background = "red";
  }
  updateSliderColor(slider.value);

  slider.oninput = e => {
    localStorage.setItem(sliderKey, e.target.value);
    updateSliderColor(e.target.value);
  };

  // Instance (daily)
  const instance = document.createElement("input");
  instance.type = "checkbox";
  instance.className = "check";
  const instKey = `instance_${i}`;
  if (isNewDay(`inst_reset_${i}`)) {
    instance.checked = false;
    localStorage.setItem(instKey, false);
    localStorage.setItem(`inst_reset_${i}`, new Date());
  } else {
    instance.checked = localStorage.getItem(instKey) === "true";
  }
  instance.onchange = () => localStorage.setItem(instKey, instance.checked);

  // Vesper (weekly)
  const vesper = document.createElement("input");
  vesper.type = "checkbox";
  vesper.className = "check";
  const vesKey = `vesper_${i}`;
  if (isNewWeek(`ves_reset_${i}`)) {
    vesper.checked = false;
    localStorage.setItem(vesKey, false);
    localStorage.setItem(`ves_reset_${i}`, new Date());
  } else {
    vesper.checked = localStorage.getItem(vesKey) === "true";
  }
  vesper.onchange = () => localStorage.setItem(vesKey, vesper.checked);

  // Elusion Trial (weekly)
  const elusion = document.createElement("input");
  elusion.type = "checkbox";
  elusion.className = "check";
  const eluKey = `elusion_${i}`;
  if (isNewWeek(`elu_reset_${i}`)) {
    elusion.checked = false;
    localStorage.setItem(eluKey, false);
    localStorage.setItem(`elu_reset_${i}`, new Date());
  } else {
    elusion.checked = localStorage.getItem(eluKey) === "true";
  }
  elusion.onchange = () => localStorage.setItem(eluKey, elusion.checked);

  row.append(acc, slider, instance, vesper, elusion);
  container.appendChild(row);
});
</script>

</body>
</html>

